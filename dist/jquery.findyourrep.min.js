/*! jquery.findyourrep 2014-03-03 Copyright (c) 2014 Dan Drinkard, Sunlight Foundation <ddrinkard@sunlightfoundation.com> under a BSD3 License.
*/!function(a,b,c){function d(b,c){return a.getJSON(b,c)}function e(b){var c;return c="object"==typeof b?a.Deferred().resolve(b):a.findYourRep.geocode(b)}function f(a,b){return a.replace(/\{\{ ?([\w\d_]+) ?\}\}/gi,function(a,c){return b[c]||""})}a.findYourRep={},a.findYourRep._version="0.0.1",a.findYourRep.sunlightApiKey=null,a.findYourRep.defaultGeocoder="google",a.findYourRep.geocoderApiKey=null,a.findYourRep.templateContext={title:"Find Your Representatives",apis:"congress, openstates",text:"Enter your address to see who represents you.",action:"Go!"},a.findYourRep.geocode=function(b,d){var e,f=new a.Deferred;return e=d===c?a.findYourRep._gc||(a.findYourRep._gc=new GeocoderJS.createGeocoder(a.findYourRep.defaultGeocoder)):new GeocoderJS.createGeocoder(d),e.geocode(b,function(a){f.resolve(a[0])}),f},a.findYourRep.openstates=function(b){var c=new a.Deferred,f="http://openstates.org/api/v1/legislators/geo?callback=?",g={};return g.apikey=a.findYourRep.sunlightApiKey,e(b).done(function(a){g.lat=a.latitude,g["long"]=a.longitude,d(f,g).done(function(a){c.resolve(a)})}),c},a.findYourRep.congress=function(b){var c=new a.Deferred,f="https://congress.api.sunlightfoundation.com/legislators/locate?callback=?",g={};return g.apikey=a.findYourRep.sunlightApiKey,e(b).done(function(a){g.latitude=a.latitude,g.longitude=a.longitude,d(f,g).done(function(a){c.resolve(a)})}),c},a.findYourRep.getTemplateContext=function(a,b){var c={};return"congress"==b?(c={senate:a.state_name,house:a.state+"-"+a.district,D:"Democrat",R:"Republican",I:"Independent"},{name:a.title+" "+a.first_name+" "+a.last_name,details:c[a.party]+", "+c[a.chamber],photoUrl:"http://theunitedstates.io/images/congress/225x275/"+a.bioguide_id+".jpg",resultUrl:"http://opencongress.org/people/show/"+a.govtrack_id}):"openstates"==b?(c={upper:"Upper Chamber",lower:"Lower Chamber",Democratic:"Democrat",Republican:"Republican",Independent:"Independent"},{name:a.full_name,details:c[a.party]+", "+a.state.toUpperCase()+"-"+a.district+" ("+c[a.chamber]+")",photoUrl:a.photo_url,resultUrl:"http://openstates.org/"+a.state+"/legislators/"+a.id}):void 0},a.findYourRep.formTemplate="<div class='find-your-rep fyr-container' id='fyr{{ idx }}' data-apis='{{ apis }}'><h3>{{ title }}</h3><p>{{ text }}</p><div class='fyr-controls'><textarea placeholder='Enter your address'>{{ defaultValue }}</textarea><button class='fyr-submit'>{{ action }}</button></div><small>Powered by <a href='http://sunlightfoundation.com'>The Sunlight Foundation</a></small></div>",a.findYourRep.resultsTemplate="<div class='fyr-results'><h3>Your Representatives</h3><div class='fyr-congress' style='display:none;'><h4>In Congress</h4><ul class='fyr-reps'></ul></div><div class='fyr-openstates' style='display:none;'><h4>State Representatives</h4><ul class='fyr-reps'></ul></div><a href='#' class='fyr-back'>&laquo; start over</a><small>Powered by <a href='http://sunlightfoundation.com'>The Sunlight Foundation</a></small></div>",a.findYourRep.resultTemplate="<li class='fyr-rep'><a href='{{ resultUrl }}'><img src='{{ photoUrl }}' alt='photo of'><h4>{{ name }}</h4><p class='fyr-details'>{{ details }}</p></a></li>",a.fn.findYourRep=function(b){var c,d=a.findYourRep.templateContext;return a.findYourRep.sunlightApiKey=b.apikey||a.findYourRep.sunlightApiKey,delete b.apikey,d=a.extend({},d,b),c=d.apis.split(/, ?/),a(this).each(function(b,e){a(e).on("click",".fyr-back",function(){a(e).html(f(a.findYourRep.formTemplate,d))}),a(e).on("click",".fyr-submit",function(){var b=a(e).find("textarea").eq(0).val();a(e).find(".fyr-container").eq(0).html(f(a.findYourRep.resultsTemplate,{})),a.findYourRep.geocode(b).done(function(b){a.each(c,function(c,d){a.findYourRep[d](b).done(function(b){var c=b.results||b,g=["senate","upper"];c=c.sort(function(a,b){return a.chamber==b.chamber?0:"-1"!=g.indexOf(a.chamber)?-1:1}),a.each(c,function(b,c){a(e).find(".fyr-"+d).eq(0).show().append(f(a.findYourRep.resultTemplate,a.findYourRep.getTemplateContext(c,d)))})})})})}),a(e).html(f(a.findYourRep.formTemplate,d))})}}(jQuery,this);