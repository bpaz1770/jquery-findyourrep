/*! jquery.findyourrep 2014-03-17 Copyright (c) 2014 Dan Drinkard, Sunlight Foundation <ddrinkard@sunlightfoundation.com> under a BSD3 License.
*/!function(a){a.FYR||(a.FYR={}),a.FYR.bootstrap=function(a,b,c){function d(b,c){return a.getJSON(b,c)}function e(b){var c;return c="object"==typeof b?a.Deferred().resolve(b):a.findYourRep.geocode(b)}function f(a,b){return a.replace(/\{\{ ?([\w\d_]+) ?\}\}/gi,function(a,c){return b[c]||""})}a.findYourRep={},a.findYourRep._version="0.0.1",a.findYourRep.sunlightApiKey=null,a.findYourRep.defaultGeocoder="google",a.findYourRep.geocoderApiKey=null,a.findYourRep.templateContext={title:"Find Your Representatives",apis:"congress, openstates",text:"Enter your address to see who represents you.",action:"Go!"},a.findYourRep.geocode=function(b,d){var e,f=new a.Deferred;return e=d===c?a.findYourRep._gc||(a.findYourRep._gc=new GeocoderJS.createGeocoder(a.findYourRep.defaultGeocoder)):new GeocoderJS.createGeocoder(d),e.geocode(b,function(a){try{f.resolve(a[0])}catch(b){f.resolve({})}}),f},a.findYourRep.openstates=function(c){var f=new a.Deferred,g="http://openstates.org/api/v1/legislators/geo?callback=?",h={};return h.apikey=a.findYourRep.sunlightApiKey,b.location.protocol.match(/https/)&&f.reject("Aborting Open:States query, because HTTPS is not supported."),e(c).done(function(a){h.lat=a.latitude,h["long"]=a.longitude,d(g,h).done(function(a){f.resolve(a)})}),f},a.findYourRep.congress=function(b){var c=new a.Deferred,f="https://congress.api.sunlightfoundation.com/legislators/locate?callback=?",g={};return g.apikey=a.findYourRep.sunlightApiKey,e(b).done(function(a){g.latitude=a.latitude,g.longitude=a.longitude,d(f,g).done(function(a){c.resolve(a)})}),c},a.findYourRep.getTemplateContext=function(a,b){var c={};return"congress"==b?(c={senate:a.state_name,house:a.state+"-"+a.district,D:"Democrat",R:"Republican",I:"Independent"},{name:a.title+" "+a.first_name+" "+a.last_name,details:c[a.party]+", "+c[a.chamber],photoUrl:"https://d26u557eiepppx.cloudfront.net/images/congress/225x275/"+a.bioguide_id+".jpg",resultUrl:"http://opencongress.org/people/show/"+a.govtrack_id}):"openstates"==b?(c={upper:"Upper Chamber",lower:"Lower Chamber",Democratic:"Democrat",Republican:"Republican",Independent:"Independent"},{name:a.full_name,details:c[a.party]+", "+a.state.toUpperCase()+"-"+a.district+" ("+c[a.chamber]+")",photoUrl:a.photo_url,resultUrl:"http://openstates.org/"+a.state+"/legislators/"+a.id}):void 0},a.findYourRep.formTemplate="<div class='find-your-rep fyr-container' id='fyr{{ idx }}' data-apis='{{ apis }}'><h3>{{ title }}</h3><p>{{ text }}</p><div class='fyr-controls'><textarea placeholder='Enter your address'>{{ defaultValue }}</textarea><button class='fyr-submit'>{{ action }}</button></div><small>Powered by <a href='http://sunlightfoundation.com'>The Sunlight Foundation</a></small></div>",a.findYourRep.resultsTemplate="<div class='fyr-results'><h3>Your Representatives</h3><div class='fyr-congress cf' style='display:none;'><h4>In Congress</h4><ul class='fyr-reps'></ul></div><div class='fyr-openstates cf' style='display:none;'><h4>State Representatives</h4><ul class='fyr-reps'></ul></div><a href='#' class='fyr-back'>&laquo; start over</a><small>Powered by <a href='http://sunlightfoundation.com'>The Sunlight Foundation</a></small></div>",a.findYourRep.resultTemplate="<li class='fyr-rep cf'><a href='{{ resultUrl }}' target='_top'><img src='{{ photoUrl }}' alt='photo of'><h4>{{ name }}</h4><p class='fyr-details'>{{ details }}</p></a></li>",a.fn.findYourRep=function(c){var d,e=a.findYourRep.templateContext;return a.findYourRep.sunlightApiKey=c.apikey||a.findYourRep.sunlightApiKey,delete c.apikey,e=a.extend({},e,c),d=e.apis.split(/, ?/),a(this).each(function(c,g){a(g).on("click",".fyr-back",function(b){b.preventDefault(),a(g).html(f(a.findYourRep.formTemplate,e))}),a(g).on("click",".fyr-submit",function(c){c.preventDefault(),c.stopPropagation();var e=a(g).find("textarea").eq(0).val();a(g).find(".fyr-container").eq(0).html(f(a.findYourRep.resultsTemplate,{})),a.findYourRep.geocode(e).done(function(b){a.each(d,function(c,d){a.findYourRep[d](b).done(function(b){var c=b.results||b||[],e=["senate","upper"];return 0===c.length||"500"==c.status?(a(g).find(".fyr-"+d).eq(0).show().find(".fyr-reps").append('<li class="fyr-rep">No results found.</li>').show(),!1):(c=c.sort(function(a,b){return a.chamber==b.chamber?0:"-1"!=e.indexOf(a.chamber)?-1:1}),void a.each(c,function(b,c){a(g).find(".fyr-"+d).eq(0).show().find(".fyr-reps").eq(0).append(f(a.findYourRep.resultTemplate,a.findYourRep.getTemplateContext(c,d)))}))})})}).fail(function(a){b.console&&console.log&&console.log(a)})}),a(g).html(f(a.findYourRep.formTemplate,e))})}},a.FYR.onNewJq=function(){var b;a.console&&console.log&&console.log("Saving new jQuery at FYR.$"),a.FYR.$=jQuery.noConflict(!0),b=a.FYR.$,a.FYR.bootstrap(a.FYR.$,a),"undefined"!=typeof FYR.$els&&b.each(FYR.$els,function(a,c){b(c.els).findYourRep(c.opts)})};var b=$.map(jQuery.fn.jquery.split("."),function(a){return("0"+a).slice(-2)}).slice(0,2).join(".");if("undefined"==typeof jQuery||"01.07">b){a.console&&console.log&&console.log("Downloading jQuery because it was old or missing...");var c=document.createElement("script");c.src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js",c.onload=FYR.onNewJq,document.getElementsByTagName("head")[0].appendChild(c),jQuery.fn.findYourRep=function(b){return a.FYR.$els||(a.FYR.$els=[]),a.FYR.$els.push({els:this,opts:b}),jQuery(this)}}else FYR.bootstrap(jQuery,a)}(this);